// Prisma Schema for Notification Service - MySQL Database
// Based on original Mongoose model: notification.model.js
// Only ONE table: Notification (matching the model)
// Nested metadata stored as JSON column (like MongoDB)

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// Notification Model - matches notification.model.js exactly
// Only ONE table for Notification (metadata in JSON)
model Notification {
  id            String   @id @db.VarChar(255) // Original: String, required, unique (UUID generated in controller)
  userId        String   @db.VarChar(255) // Original: String, required
  type          String   @db.VarChar(50) // Original: enum ['in_app', 'sms', 'both'], required
  title         String   @db.VarChar(100) // Original: String, required, trim, maxlength: 100
  message       String   @db.VarChar(500) // Original: String, required, trim, maxlength: 500
  phoneNumber   String?  @db.VarChar(50) // Original: String, required if type is 'sms' or 'both'
  status        String   @default("pending") @db.VarChar(50) // Original: enum, default: 'pending'
  priority      String   @default("medium") @db.VarChar(50) // Original: enum, default: 'medium'
  
  // Metadata stored as JSON (matching MongoDB structure)
  metadata      Json     @default("{}") // Original: mongoose.Schema.Types.Mixed, default: {}
  
  sentAt        DateTime? // Original: Date
  readAt        DateTime? // Original: Date
  deliveredAt   DateTime? // Original: Date
  errorMessage  String?  @db.VarChar(500) // Original: String
  retryCount    Int      @default(0) // Original: Number, default: 0
  maxRetries    Int      @default(3) // Original: Number, default: 3
  
  createdAt     DateTime @default(now()) @map("created_at") // Original: timestamps: true
  updatedAt     DateTime @updatedAt @map("updated_at") // Original: timestamps: true

  @@map("notifications")
  @@index([userId, createdAt(sort: Desc)])
  @@index([status])
  @@index([type])
  @@index([priority])
}

