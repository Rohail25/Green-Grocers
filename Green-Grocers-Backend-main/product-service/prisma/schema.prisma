// Prisma Schema for Product Service - MySQL Database
// Based on original Mongoose models in src/models/
// Only 5 tables: Product, Brand, Category, Package, ReviewRating (matching the 5 models)
// Nested arrays/objects stored as JSON columns (like MongoDB)

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// Brand Model - matches brand.model.js exactly
model Brand {
  id          String   @id @default(uuid())
  title       String   @db.VarChar(255) // Original: String, required
  image       String   @db.VarChar(500) // Original: String, required
  description String?  @db.Text // Original: String
  createdAt   DateTime @default(now()) @map("created_at") // Original: timestamps: true
  updatedAt   DateTime @updatedAt @map("updated_at") // Original: timestamps: true

  @@map("brands")
  @@index([title])
}

// Category Model - matches category.model.js exactly
model Category {
  id        String   @id @default(uuid())
  title     String   @db.VarChar(255) // Original: String, required
  image     String   @db.VarChar(500) // Original: String, required
  createdAt DateTime @default(now()) @map("created_at") // Original: timestamps: true
  updatedAt DateTime @updatedAt @map("updated_at") // Original: timestamps: true

  @@map("categories")
  @@index([title])
}

// Product Model - matches product.model.js exactly
// Only ONE table for Product (all nested data in JSON)
model Product {
  id                  String   @id @default(uuid())
  vendorId            String?  @db.VarChar(255) // Original: String
  brandId             String?  @db.VarChar(255) // Original: ObjectId, ref: 'Brand'
  categoryId          String?  @db.VarChar(255) // Original: ObjectId, ref: 'Category'
  
  // Product Information
  name                String   @db.VarChar(255) // Original: String, required
  description         String?  @db.Text // Original: String
  itemSize            String?  @db.VarChar(255) // Original: String
  totalQuantityInStock Int     @default(0) // Original: Number, default: 0
  
  // Product Images - stored as JSON array
  images              Json     @default("[]") // Original: [String]
  
  // Inventory Variants - stored as JSON array (matching MongoDB structure)
  variants            Json     @default("[]") // Original: [{images, size, color, quantity, inStock}]
  
  // Other Information
  brand               String?  @db.VarChar(255) // Original: String
  category            String?  @db.VarChar(255) // Original: String
  gender              String?  @db.VarChar(50) // Original: enum ['Male', 'Female', 'Unisex']
  collection          String?  @db.VarChar(255) // Original: String
  tags                Json     @default("[]") // Original: [String]
  
  // Price & Discount
  retailPrice         Decimal? @db.Decimal(10, 2) // Original: Number
  wholesalePrice      Decimal? @db.Decimal(10, 2) // Original: Number
  minWholesaleQty     Int?     // Original: Number
  preSalePrice        Decimal? @db.Decimal(10, 2) // Original: Number
  
  // Nested objects stored as JSON (matching MongoDB structure)
  preSalePeriod       Json?    // Original: {start: Date, end: Date}
  discount            Json?    // Original: {type: String, value: Number}
  
  // Applied Coupons - stored as JSON array
  appliedCoupons      Json     @default("[]") // Original: [{couponId, couponType, code, discountValue, startDate, endDate}]
  
  // Product status
  status              String   @default("active") @db.VarChar(50) // Original: enum ['active', 'inactive'], default: 'active'
  isFeatured          Boolean  @default(false) // Original: Boolean, default: false
  
  createdAt           DateTime @default(now()) @map("created_at") // Original: timestamps: true
  updatedAt           DateTime @updatedAt @map("updated_at") // Original: timestamps: true

  @@map("products")
  @@index([vendorId])
  @@index([brandId])
  @@index([categoryId])
  @@index([status])
  @@index([isFeatured])
}

// Package Model - matches package.model.js exactly
// Only ONE table for Package (items array and discount in JSON)
model Package {
  id          String   @id @default(uuid())
  name        String   @db.VarChar(255) // Original: String, required
  description String?  @db.Text // Original: String
  image       String?  @db.VarChar(500) // Original: String
  packageDay  String   @db.VarChar(50) // Original: enum ['Monday', 'Tuesday', ...], required
  
  // Items array stored as JSON (matching MongoDB structure)
  items       Json     @default("[]") // Original: [{productId, productName, quantity, price}]
  
  retailPrice Decimal  @db.Decimal(10, 2) // Original: Number, required
  
  // Discount object stored as JSON
  discount    Json     @default("{\"type\":\"percentage\",\"value\":0}") // Original: {type: String, value: Number}
  
  status      String   @default("active") @db.VarChar(50) // Original: enum ['active', 'inactive'], default: 'active'
  isFeatured  Boolean  @default(false) // Original: Boolean, default: false
  tags        Json     @default("[]") // Original: [String]
  category    String?  @db.VarChar(255) // Original: String
  rating      Decimal  @default(0) @db.Decimal(3, 2) // Original: Number, default: 0
  totalOrders Int      @default(0) // Original: Number, default: 0
  
  createdAt   DateTime @default(now()) @map("created_at") // Original: timestamps: true
  updatedAt   DateTime @updatedAt @map("updated_at") // Original: timestamps: true

  @@map("packages")
  @@index([packageDay])
  @@index([status])
  @@index([isFeatured])
}

// ReviewRating Model - matches review.rating.model.js exactly
model ReviewRating {
  id        String   @id @default(uuid())
  productId String   @db.VarChar(255) // Original: ObjectId, ref: "Product"
  
  // User object stored as JSON (matching MongoDB structure)
  user      Json     // Original: {userId: ObjectId, name: String, email: String, profileImage: String}
  
  rating    Int      // Original: Number, required
  review    String   @db.Text // Original: String, required
  date      DateTime @default(now()) // Original: Date, default: Date.now
  createdAt DateTime @default(now()) @map("created_at") // Original: timestamps: true
  updatedAt DateTime @updatedAt @map("updated_at") // Original: timestamps: true

  @@map("review_ratings")
  @@index([productId])
  @@index([date])
}

